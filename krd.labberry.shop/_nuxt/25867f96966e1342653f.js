(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{348:function(t,e,r){"use strict";r.r(e);r(5);var n,o,c=r(0),h=(r(73),r(107)),d=r(74),l=d.helpers.regex("alpha",/^((\+7|7|8)+(\()+([0-9]){3})+(\))+([0-9]{3})+(-)+([0-9]{2})+(-)+([0-9]{2})$/),f={name:"AuthPage",middleware:"auth",mixins:[h.validationMixin],validations:{phone:{required:d.required,phoneAlpha:l},code:{required:d.required}},data:function(){return{phone:"",code:"",isCode:!1,roleId:4}},computed:{phoneErrors:function(){var t=[];return this.$v.phone.$dirty?(!this.$v.phone.required&&t.push("Обязательное поле!"),!this.$v.phone.phoneAlpha&&t.push("Номер телефона не валиден! +7(___)___-__-__"),t):t},codeErrors:function(){var t=[];return this.$v.code.$dirty?(!this.$v.code.required&&t.push("Обязательное поле!"),t):t}},methods:{filterPhone:function(){return this.phone.replace(/[^0-9]/g,"")},getCode:(o=Object(c.a)(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.$v.$touch(),!this.$v.phone.$error){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,this.$store.dispatch("auth/registration",{phone:this.filterPhone(),roleId:this.roleId});case 5:(e=t.sent).id?this.isCode=!0:401===e?this.$store.dispatch("fetchNotification",{isActive:!0,type:"error",message:"Пользователь с таким номером уже зарегестрирован"}):this.$store.dispatch("fetchNotification",{isActive:!0,type:"error",message:"Произошла ошибка при регистрации"});case 7:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)}),login:(n=Object(c.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.$v.$touch(),!this.$v.$error){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,this.$store.dispatch("auth/login",{phone:this.filterPhone(),password:this.code});case 5:t.sent.access_token?this.$router.push("/profile"):this.$store.dispatch("fetchNotification",{isActive:!0,type:"error",message:"Неверный логин или пароль"});case 7:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},beforeRouteLeave:function(t,e,r){this.$store.dispatch("fetchMenu",!1),this.$store.dispatch("fetchCityModal",!1),this.$store.dispatch("fetchCallbackModal",!1),r()}},v=r(3),component=Object(v.a)(f,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("main",[r("section",{staticClass:"section section--full-screen d-flex f-column align-center justify-center"},[t._m(0),r("div",{staticClass:"container d-flex align-center justify-center"},[r("form",{staticClass:"form form--auth"},[r("div",{staticClass:"form--card"},[r("div",{staticClass:"form--card-inner"},[r("m-input",{class:{"input--error":t.phoneErrors.length>0},attrs:{inputId:"phone",placeholder:"+7(___)___-__-__",value:t.phone,required:!0,footerText:t.phoneErrors[0],mask:"+#(###)###-##-##",disabled:t.isCode},on:{input:function(e){t.phone=e,t.$v.phone.$touch()},blur:function(e){return t.$v.phone.$touch()}}}),t.isCode?r("m-input",{class:{"input--error":t.codeErrors.length>0},attrs:{inputId:"code",placeholder:"Код из смс",value:t.code,footerText:t.codeErrors[0],type:"password"},on:{input:function(e){t.code=e},blur:function(e){return t.$v.code.$touch()}}}):t._e(),t.isCode?t._e():r("div",{staticClass:"button button_brand",on:{click:t.getCode}},[r("div",{staticClass:"button--text"},[t._v("Выслать код")])]),r("nuxt-link",{staticClass:"link",attrs:{to:"/login"}},[t._v("У Вас уже есть аккаунт?")]),t.isCode?r("div",{staticClass:"button button_brand",on:{click:t.login}},[r("div",{staticClass:"button--text"},[t._v("Продолжить")])]):t._e()],1)])])])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"container"},[e("h1",{staticClass:"section--title text--center"},[this._v("Регистрация")])])}],!1,null,null,null);e.default=component.exports}}]);